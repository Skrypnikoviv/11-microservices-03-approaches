# Домашнее задание к занятию «Микросервисы: подходы» - Скрыпников Илья

## Задача 1: Обеспечение разработки
### Решение: **GitLab CI/CD + HashiCorp Vault + Docker + Kubernetes**
1. **Система контроля версий Git**: GitLab (облачная версия или self-hosted) — предоставляет Git-репозитории с поддержкой изоляции на уровне проектов (репозиторий на каждый сервис).
2. **CI/CD**:
   - **GitLab CI/CD**:
     - Запуск сборки по событию (push, merge request) или вручную с параметрами.
     - Кастомные шаги через `.gitlab-ci.yml`.
     - Шаблоны конфигураций через `include` и `extends`.
     - Параллельные сборки и тесты (параметры `parallel` и `stages`).
   - **Docker**: Собственные образы для сборки через `Dockerfile` и Docker Registry.
   - **Self-hosted агенты**: GitLab Runner можно развернуть на собственных серверах.
3. **Безопасное хранение секретов**: HashiCorp Vault для управления секретами (ключи, пароли), интеграция с GitLab через переменные CI/CD.
4. **Настройки сборки**:
   - Переменные окружения в GitLab CI с защитой (masked variables).
   - Конфигурации через ветки, теги или динамические переменные.

**Обоснование**: GitLab обеспечивает полный цикл DevOps, включая облачный Git, CI/CD, шаблоны и интеграцию с Docker/Kubernetes. Vault решает проблему секретов, а GitLab Runner поддерживает гибкость развертывания.

---

## Задача 2: Логи
### Решение: **EFK Stack (Elasticsearch + Fluentd/Fluent Bit + Kibana)**
1. **Сбор логов**:
   - **Fluentd/Fluent Bit**: Агенты на хостах собирают логи из `stdout` (интеграция с Docker через драйвер логов).
   - **Гарантированная доставка**: Буферизация в Kafka или Redis перед отправкой в Elasticsearch.
2. **Хранение и анализ**:
   - **Elasticsearch**: Централизованное хранилище с возможностью поиска и фильтрации.
   - **Kibana**: Веб-интерфейс для визуализации, создания сохраненных поисков и ссылок на них.
3. **Минимальные требования**:
   - Fluent Bit легковесен, подходит для контейнеров и хостов.

**Обоснование**: EFK Stack — стандарт для микросервисов. Fluent Bit собирает логи без модификации кода приложений, Elasticsearch обеспечивает масштабируемость, а Kibana — удобный интерфейс для разработчиков.

---

## Задача 3: Мониторинг
### Решение: **Prometheus + Grafana + cAdvisor/Node Exporter**
1. **Сбор метрик**:
   - **Prometheus**: Собирает метрики через HTTP-эндпоинты (pull-модель).
   - **Node Exporter**: Метрики хостов (CPU, RAM, HDD, Network).
   - **cAdvisor**: Метрики контейнеров (ресурсы сервисов).
   - **Кастомные экспортеры**: Для специфичных метрик сервисов.
2. **Визуализация и анализ**:
   - **Grafana**: Панели для агрегации метрик, настройка дашбордов, запросы через PromQL.
3. **Интеграция**:
   - Alertmanager для оповещений (необязательно, но рекомендуется).

**Обоснование**: Prometheus — де-факто стандарт для мониторинга микросервисов. Grafana предоставляет гибкий интерфейс, а cAdvisor/Node Exporter покрывают все требования по метрикам.

---

### Итог:
- **GitLab + Vault + Docker** обеспечивают полный цикл разработки и доставки.
- **EFK Stack** решает задачи сбора и анализа логов.
- **Prometheus + Grafana** дают детальный мониторинг системы.
Все решения облачные (или поддерживают облачное развертывание) и соответствуют требованиям масштабируемости микросервисов.
